---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import { client } from '../lib/sanity';

let experiences = [];
try {
  experiences = await client.fetch(`*[_type == "experience"] | order(startDate desc) {
    company,
    role,
    description,
    startDate,
    endDate,
    isCurrent
  }`);
} catch (error) {
  console.error("Error fetching experiences:", error);
}
---

<Layout title="Experiências - Matheus Melo | Portfolio">
	<Header />
	
	<main class="overflow-hidden bg-gray-50 min-h-screen pt-32">
		<section id="experience" class="px-6 md:px-12">
			<div class="max-w-4xl mx-auto">
				<h1 class="font-heading font-light text-3xl md:text-5xl mb-16 text-primary animate-fade-in-up">
					Experiências
				</h1>
				
				<div class="relative border-l border-gray-300 ml-3 space-y-16 animate-fade-in-up delay-200">
					{experiences && experiences.length > 0 ? experiences.map((exp) => (
						<div class="relative pl-12">
							<div class="absolute -left-[7px] top-2 w-3.5 h-3.5 bg-black rounded-full border-4 border-gray-50"></div>
							<span class="text-xs text-gray-500 font-sans tracking-wider uppercase block mb-2">
								{exp.startDate ? new Date(exp.startDate).getFullYear() : ''} — {exp.isCurrent ? 'Presente' : (exp.endDate ? new Date(exp.endDate).getFullYear() : '')}
							</span>
							<h3 class="font-heading text-2xl md:text-3xl font-bold mb-1">{exp.role}</h3>
							<div class="font-sans text-lg text-gray-800 mb-4 font-medium">{exp.company}</div>
							<p class="font-sans text-gray-600 leading-relaxed text-base max-w-2xl">
								{exp.description}
							</p>
						</div>
					)) : <p class="text-gray-500 font-sans italic">Nenhuma experiência registrada ainda.</p>}
				</div>
			</div>
		</section>
	</main>
</Layout>

<style>
	.animate-fade-in-up {
		animation: fadeInUp 0.8s ease-out forwards;
		opacity: 0;
		transform: translateY(20px);
	}
	
	.delay-200 {
		animation-delay: 200ms;
	}

	@keyframes fadeInUp {
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}
</style>
